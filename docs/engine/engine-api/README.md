## engine-api — Python 신용평가/심사 엔진

### 1. 이 폴더의 목적

- `engine/engine-api`의 역할을 **발표용으로 요약**합니다.  
- 자세한 설명은 `engine/engine-api/GUIDE.md`를 참고하세요.

---

### 2. 서비스 역할

- **포트 8000**, FastAPI 기반 **AI 엔진 서비스**  
- 입고·정산 데이터를 바탕으로 **가맹점/마트의 신용점수·등급·리스크 지표**를 계산합니다.
- 호출 방식
  - `erp-api`의 Bull Queue Worker가 **HTTP POST**로 비동기 호출 (주 사용 경로)
  - 특정 버전 엔드포인트(v10, v41 등)를 직접 호출하는 경로도 확장 가능

---

### 3. 주요 엔드포인트

| 버전 | 경로                 | 설명                      | 호출자            |
|------|----------------------|---------------------------|-------------------|
| v10  | `/api/v10/score`     | 가맹점 신용점수 산출         | `erp-api` Queue   |
| v41  | `/api/v41/screen`    | 마트 심사 평가              | (확장용)          |
| 기타 | `/api/dual-track/*`  | 듀얼트랙 리스크, 지점 리스크 등 | (확장용)          |
| -    | `/health`            | 헬스체크                    | Docker/모니터링   |

---

### 4. 신용평가 로직 개요 (v10 예시)

1. PostgreSQL에서 **최근 N개월 입고·정산 데이터**를 Pandas DataFrame으로 조회  
2. 다음과 같은 요소들을 점수화
   - 거래 규모 (총 입고 금액)  
   - 입고 확인률 (확인/전체)  
   - 정산 이행률 (완료/전체)  
   - 거래 안정성 (금액 변동성 등)  
3. 요소별 점수를 가중합하여 **0~1000점 스코어와 등급(A~E)** 산출  
4. 결과를 `credit_scores` 등 관련 테이블에 저장  
5. 응답 JSON으로 `{ score, grade, factors }` 반환

---

### 5. 기술 스택

- **언어/프레임워크**: Python 3.11, FastAPI  
- **데이터 처리**: Pandas, NumPy  
- **DB 연동**: psycopg2, SQL 기반 조회 (`pd.read_sql`)  
- **모델/스키마**: Pydantic 모델로 요청/응답 구조 정의  
- **실행**: `uvicorn main:app --reload --port 8000`

---

### 6. 발표에서 어떻게 보여줄지

- 전체 아키텍처 그림에서 **오른쪽 하단 \"AI/ENGINE\" 박스**를 기준으로 설명:
  1. `erp-api`의 Queue Worker → `engine-api` HTTP 호출  
  2. `engine-api` → PostgreSQL에서 데이터 조회 → Pandas 계산  
  3. 결과를 DB에 저장 후, 필요 시 백엔드/대시보드에서 조회  
- \"업무 시스템(입고/정산) 데이터\"와 \"AI 계산\"이 **완전히 분리된 모듈**이라는 점을 강조하면,  
  추후 다른 신용모형/외부 신용정보 연동 등 **확장성**을 어필하기 좋습니다.

