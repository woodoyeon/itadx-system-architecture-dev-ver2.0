# ItaDX — 프로그래밍 언어 & 기술스택

> **한 줄 요약:** TypeScript(프론트+백) + Python(AI) + PostgreSQL/Redis(데이터) + Docker(인프라) 기반 풀스택 모노레포 프로젝트

---

## 1. 언어별 기술스택 요약

```
┌─────────────────────────────────────────────────────────────┐
│                       ItaDX 기술스택                          │
├───────────────┬───────────────┬──────────────┬──────────────┤
│  프론트엔드     │  백엔드        │  AI 엔진      │  인프라        │
│  TypeScript   │  TypeScript   │  Python      │  Docker      │
│  Next.js 14   │  Nest.js 10   │  FastAPI     │  PostgreSQL  │
│  React 18     │  TypeORM      │  v10/v41     │  Redis       │
│  Zustand      │  Passport     │  ITANET 연동  │  Nginx       │
└───────────────┴───────────────┴──────────────┴──────────────┘
```

---

## 2. 프론트엔드 (apps/admin-web)

| 항목 | 기술 | 버전 | 설명 |
|------|------|------|------|
| **언어** | TypeScript | 5.4.0 | 정적 타입 |
| **프레임워크** | Next.js | 14.2.15 | App Router, SSR, API Routes |
| **UI 라이브러리** | React | 18.3.1 | 컴포넌트 기반 UI |
| **상태관리** | Zustand | - | 로그인 상태 등 글로벌 스토어 (auth-store.ts) |
| **서버 상태** | React Query | - | API 데이터 캐싱, 자동 리패치 (hooks/*.ts) |
| **HTTP 클라이언트** | Axios | - | JWT 자동 첨부 인터셉터 (api.ts) |
| **실시간 통신** | Socket.io Client | - | WebSocket 이벤트 수신 (socket.ts) |
| **스타일링** | Tailwind CSS | - | 유틸리티 기반 CSS |
| **포트** | - | 3000 | 개발 서버 |

### 프론트엔드 주요 파일과 역할

```
apps/admin-web/src/
├── lib/
│   ├── api.ts              ← Axios 인스턴스 (baseURL: '/api', JWT 자동첨부)
│   └── socket.ts           ← WebSocket 연결 관리
├── hooks/
│   ├── use-receivings.ts   ← 입고 관련 API 호출 (React Query)
│   ├── use-socket.ts       ← 실시간 이벤트 구독
│   └── use-dashboard.ts    ← 대시보드 KPI 데이터
├── stores/
│   └── auth-store.ts       ← Zustand: accessToken, refreshToken, user 정보
├── app/
│   ├── login/              ← 로그인 페이지
│   ├── mart/receiving/     ← ★ 입고확인 페이지
│   └── bank/dashboard/     ← 은행 대시보드
└── components/ui/          ← 공통 UI 컴포넌트 (버튼, 테이블, 모달 등)
```

---

## 3. 백엔드 — Node.js 서비스 (services/*)

| 항목 | 기술 | 버전 | 설명 |
|------|------|------|------|
| **언어** | TypeScript | 5.4.0 | 프론트와 동일 언어로 타입 공유 |
| **프레임워크** | Nest.js | 10.3.0 | 모듈 기반 서버 프레임워크 (DI, 데코레이터) |
| **ORM** | TypeORM | 0.3.x | PostgreSQL 매핑 (11개 Entity) |
| **인증** | Passport + JWT | - | 토큰 기반 인증 |
| **비동기 큐** | Bull Queue | - | Redis 기반 작업 큐 (신용평가 비동기 처리) |
| **실시간** | Socket.io | - | WebSocket Gateway (은행 알림) |
| **유효성 검증** | class-validator | - | DTO 기반 입력 검증 |

### 서비스별 상세

#### auth-api (포트 4001) — 인증 서비스

| 기능 | 엔드포인트 | 설명 |
|------|-----------|------|
| 로그인 | `POST /api/auth/login` | email + password → JWT 발급 |
| 프로필 조회 | `GET /api/auth/profile` | 현재 사용자 정보 |
| 토큰 갱신 | `POST /api/auth/refresh` | refreshToken → 새 accessToken |

핵심 기술: JWT (Access Token + Refresh Token), Redis 블랙리스트, Passport Strategy

#### admin-api (포트 4000) — 관리 서비스

| 기능 | 엔드포인트 | 설명 |
|------|-----------|------|
| 마트 CRUD | `/api/marts` | 마트 조회, 등록, 수정, 삭제 |
| 사용자 관리 | `/api/users` | 사용자 목록, 역할 변경 |
| 대시보드 | `/api/dashboard` | KPI 통계 데이터 |

핵심 기술: TypeORM Repository 패턴, Roles Guard (역할별 접근 제어)

#### erp-api (포트 4002) — ★ 핵심 비즈니스 서비스

| 기능 | 엔드포인트 | 설명 |
|------|-----------|------|
| 입고 목록 | `GET /api/receivings` | 필터링 + 페이지네이션 |
| ★ 입고확인 | `PATCH /api/receivings/:id/confirm` | 상태 변경 + 신용평가 트리거 |
| 정산 관리 | `/api/settlements` | 정산 조회, 처리 |

핵심 기술: 비관적 잠금 (SELECT FOR UPDATE), Bull Queue (비동기 신용평가), 트랜잭션 관리

#### gateway-api (포트 4003) — API 게이트웨이

| 기능 | 설명 |
|------|------|
| URL 라우팅 | 경로 prefix 보고 각 서비스로 프록시 |
| Rate Limit | Redis 기반 요청 속도 제한 |
| 프록시 | http-proxy-middleware 사용 |

---

## 4. AI 엔진 — Python (engine/engine-api)

| 항목 | 기술 | 버전 | 설명 |
|------|------|------|------|
| **언어** | Python | 3.11 | AI/ML 생태계 활용 |
| **프레임워크** | FastAPI | 0.104.1 | 비동기 REST API |
| **포트** | - | 8000 | 개발 서버 |

### AI 서비스 상세

| 서비스 | 파일 | 설명 |
|--------|------|------|
| **v10 — 신용평가** | `services/v10_service.py` | ★ 거래처 신용점수 산출 |
| **v41 — 마트심사** | `services/v41_service.py` | 마트 심사 평가 |
| **v10 라우터** | `routers/v10_router.py` | FastAPI 엔드포인트 정의 |

### 연동 흐름

```
erp-api (Node.js)
    │ Bull Queue 작업 생성
    ▼
credit-score.processor.ts
    │ HTTP 요청
    ▼
engine-api (Python :8000)
    │ v10_service.py 실행
    ▼
ITANET 평가서버
    │ v10: 신용평가 / v2: 마트심사
    ▼
결과 반환 → DB 저장 → WebSocket 알림
```

---

## 5. 인프라 & 데이터베이스

### PostgreSQL 15

| 항목 | 설정 |
|------|------|
| **버전** | 15-alpine |
| **포트** | 5432 |
| **역할** | 메인 데이터베이스 |
| **테이블 수** | 11개 (TypeORM Entity 매핑) |
| **ORM** | TypeORM 0.3.x |
| **초기화** | `scripts/init-db.sql` (테이블 생성), `scripts/seed.sql` (테스트 데이터) |

### Redis 7

| 항목 | 설정 |
|------|------|
| **버전** | 7-alpine |
| **포트** | 6379 |
| **용도 1** | JWT 블랙리스트 (로그아웃 시 토큰 무효화) |
| **용도 2** | Bull Queue 백엔드 (비동기 작업 큐) |
| **용도 3** | Rate Limit 카운터 (API 속도 제한) |

### Docker Compose

| 항목 | 설정 |
|------|------|
| **파일** | `infra/docker/docker-compose.yaml` |
| **역할** | 전체 서비스 컨테이너 한 번에 실행/관리 |
| **컨테이너 수** | 8개 (6 서비스 + PostgreSQL + Redis) |

### Nginx

| 항목 | 설정 |
|------|------|
| **파일** | `infra/nginx/nginx.conf` |
| **역할 1** | 리버스 프록시 (외부 → 내부 서비스) |
| **역할 2** | WebSocket 업그레이드 지원 |
| **역할 3** | SSL 종단 (HTTPS) |
| **도메인** | https://itadx.co.kr |

### pnpm workspace

| 항목 | 설정 |
|------|------|
| **파일** | `pnpm-workspace.yaml` |
| **역할** | 모노레포 패키지 관리 |
| **장점** | 패키지를 전역 저장소에 한 번만 보관하고 심볼릭 링크로 공유 → 디스크/설치 속도 절약 |

---

## 6. 공통 라이브러리 (libs/*)

프론트와 백에서 공유하는 공통 코드입니다.

| 라이브러리 | 경로 | 설명 |
|-----------|------|------|
| **auth** | `libs/auth/` | JWT Guard, Roles Guard, @CurrentUser 데코레이터 |
| **database** | `libs/database/` | TypeORM Entity 정의 (11개 테이블 매핑) |
| **audit** | `libs/audit/` | 감사 로그 자동 기록 |
| **websocket** | `libs/websocket/` | WebSocket Gateway (실시간 이벤트) |
| **common** | `libs/common/` | API 응답 형식 (`createResponse`), 에러 코드 |

---

## 7. 기술스택 한눈에 보기

```
┌──────────────────────────────────────────────────────┐
│                    프론트엔드                           │
│  TypeScript 5.4 · Next.js 14.2 · React 18.3         │
│  Zustand · React Query · Axios · Socket.io Client    │
│  Tailwind CSS                                        │
├──────────────────────────────────────────────────────┤
│                     백엔드                             │
│  TypeScript 5.4 · Nest.js 10.3 · TypeORM 0.3.x      │
│  Passport · JWT · Bull Queue · Socket.io             │
│  class-validator                                     │
├──────────────────────────────────────────────────────┤
│                    AI 엔진                             │
│  Python 3.11 · FastAPI 0.104.1                       │
│  ITANET 평가서버 연동 (v10 신용평가, v2 마트심사)         │
├──────────────────────────────────────────────────────┤
│                     인프라                             │
│  PostgreSQL 15 · Redis 7 · Docker Compose            │
│  Nginx · pnpm workspace                              │
└──────────────────────────────────────────────────────┘
```
