# ItaDX — 프로젝트 폴더 구조

> **한 줄 요약:** pnpm workspace 모노레포 — apps(프론트) / services(백엔드 4개) / engine(AI) / libs(공통) / infra(인프라)

---

## 1. 최상위 폴더 구조

```
itadx-final/
│
├── apps/                    ← 프론트엔드 애플리케이션
├── services/                ← 백엔드 마이크로서비스 (4개)
├── engine/                  ← Python AI 엔진
├── libs/                    ← 공통 라이브러리 (백엔드 공유)
├── scripts/                 ← DB 초기화, 테스트 데이터
├── infra/                   ← Docker, Nginx 설정
│
├── .eslintrc.js             ← ESLint 설정 (전체 프로젝트 린트 규칙)
├── .gitignore               ← Git 무시 파일
├── .gitlab-ci.yml           ← GitLab CI/CD 파이프라인
├── .prettierrc              ← Prettier 코드 포맷팅 설정
├── CLAUDE.md                ← Claude Code 프로젝트 컨텍스트
├── docker-compose.dev.yaml  ← 개발용 Docker Compose
├── docker-compose.yaml      ← 운영용 Docker Compose
├── package.json             ← 루트 패키지 (pnpm workspace)
├── pnpm-lock.yaml           ← 의존성 잠금 파일
├── pnpm-workspace.yaml      ← 워크스페이스 정의
├── README.md                ← 프로젝트 README
├── tsconfig.base.json       ← TypeScript 베이스 설정
└── turbo.json               ← Turborepo 빌드 파이프라인
```

---

## 2. apps/ — 프론트엔드

```
apps/
└── admin-web/                        ← Next.js 프론트엔드 (:3000)
    │
    ├── src/
    │   ├── lib/                      ← 핵심 유틸리티
    │   │   ├── api.ts                   ★ Axios 인스턴스
    │   │   │                              - baseURL: '/api'
    │   │   │                              - JWT 자동첨부 인터셉터
    │   │   │                              - 모든 API 요청의 출발점
    │   │   └── socket.ts                WebSocket 연결 관리
    │   │                                  - Socket.io 클라이언트
    │   │                                  - 실시간 이벤트 수신
    │   │
    │   ├── hooks/                    ← React Query 커스텀 훅
    │   │   ├── use-receivings.ts        ★ 입고확인 API 호출
    │   │   │                              - api.get('/receivings')
    │   │   │                              - api.patch('/receivings/:id/confirm')
    │   │   ├── use-socket.ts            실시간 이벤트 구독
    │   │   │                              - 신용평가 완료 알림
    │   │   │                              - 대시보드 실시간 갱신
    │   │   └── use-dashboard.ts         대시보드 KPI 데이터
    │   │
    │   ├── stores/                   ← Zustand 상태 관리
    │   │   └── auth-store.ts            로그인 상태
    │   │                                  - accessToken, refreshToken
    │   │                                  - user 정보
    │   │                                  - setTokens(), logout()
    │   │
    │   ├── app/                      ← Next.js App Router (페이지)
    │   │   ├── login/                   로그인 화면
    │   │   │   └── page.tsx                - email, password 입력
    │   │   │                               - api.post('/auth/login')
    │   │   ├── mart/
    │   │   │   └── receiving/           ★ 입고확인 화면
    │   │   │       └── page.tsx            - 입고 목록 테이블
    │   │   │                               - 입고확인 버튼
    │   │   └── bank/
    │   │       └── dashboard/           은행 대시보드
    │   │           └── page.tsx            - KPI 차트
    │   │                                   - 실시간 알림
    │   │
    │   ├── components/               ← 재사용 컴포넌트
    │   │   └── ui/                      공통 UI (버튼, 테이블, 모달 등)
    │   │
    │   └── types/                    ← TypeScript 타입 정의
    │       └── index.ts                 API 응답 타입 등
    │
    └── next.config.js                ← Next.js 설정
                                         - rewrite: /api/* → Gateway(4003)
```

### 프론트엔드 데이터 흐름

```
[페이지 컴포넌트]
    │ useReceivings() 같은 커스텀 훅 호출
    ▼
[hooks/use-*.ts]
    │ api.get(), api.patch() 등 호출
    ▼
[lib/api.ts]
    │ Axios 인스턴스 + JWT 자동첨부
    │ baseURL: '/api'
    ▼
[next.config.js rewrite]
    │ /api/* → http://localhost:4003/api/*
    ▼
[Gateway :4003] → 각 백엔드 서비스
```

---

## 3. services/ — 백엔드 마이크로서비스

```
services/
│
├── auth-api/                         ← JWT 인증 서비스 (:4001)
│   └── src/
│       └── auth/
│           ├── auth.controller.ts       @Post('login'), @Get('profile')
│           ├── auth.service.ts          ★ 로그인/토큰 발급 로직
│           ├── auth.module.ts           모듈 정의
│           ├── dto/
│           │   └── login.dto.ts         { email, password } 유효성 검증
│           └── strategies/
│               └── jwt.strategy.ts      Passport JWT 전략
│
├── admin-api/                        ← 마트 CRUD 서비스 (:4000)
│   └── src/
│       ├── mart/
│       │   ├── mart.controller.ts       @Get(), @Post(), @Patch(), @Delete()
│       │   ├── mart.service.ts          마트 조회/등록/수정/삭제
│       │   └── mart.module.ts
│       ├── user/
│       │   └── ...                      사용자 관리
│       └── dashboard/
│           └── ...                      대시보드 KPI
│
├── erp-api/                          ← ★★★ 핵심 비즈니스 서비스 (:4002)
│   └── src/
│       ├── receiving/
│       │   ├── receiving.controller.ts  @Get(), @Patch(':id/confirm')
│       │   ├── receiving.service.ts     ★★★ 입고확인 핵심 로직
│       │   │                              - 비관적 잠금 (SELECT FOR UPDATE)
│       │   │                              - 트랜잭션으로 상태 변경
│       │   │                              - Bull Queue에 신용평가 작업 추가
│       │   └── receiving.module.ts
│       ├── settlement/
│       │   └── ...                      정산 관리
│       └── queue/
│           └── credit-score.processor.ts  ★ Bull Queue Worker
│                                            - 큐에서 작업 꺼내서
│                                            - engine-api(8000) 호출
│                                            - 신용점수 DB 저장
│                                            - WebSocket 알림 전송
│
└── gateway-api/                      ← API 게이트웨이 (:4003)
    └── src/
        └── proxy/
            └── proxy.middleware.ts       ★ URL → 서비스 매핑
                                           - /api/auth → 4001
                                           - /api/marts → 4000
                                           - /api/receivings → 4002
```

### 백엔드 서비스 포트 정리

| 서비스 | 포트 | 핵심 파일 | 역할 |
|--------|------|----------|------|
| auth-api | 4001 | `auth.service.ts` | 로그인, JWT 발급/갱신 |
| admin-api | 4000 | `mart.service.ts` | 마트/사용자 CRUD |
| **erp-api** | **4002** | **`receiving.service.ts`** | **★ 입고확인, 정산** |
| gateway-api | 4003 | `proxy.middleware.ts` | URL 라우팅 |

---

## 4. engine/ — Python AI 엔진

```
engine/
└── engine-api/                       ← FastAPI 서비스 (:8000)
    │
    ├── main.py                          FastAPI 앱 진입점
    │
    ├── routers/
    │   └── v10_router.py                FastAPI 엔드포인트 정의
    │                                      - POST /v10/evaluate
    │
    ├── services/
    │   ├── v10_service.py               ★ 신용평가 로직
    │   │                                  - 거래 데이터 기반 점수 산출
    │   │                                  - ITANET 평가서버 연동
    │   └── v41_service.py               마트 심사 로직
    │
    └── requirements.txt                 Python 의존성
```

### AI 엔진 호출 흐름

```
erp-api                          engine-api
(credit-score.processor.ts)  →   (v10_router.py)
    │                                │
    │ POST /v10/evaluate             │ v10_service.py
    │ { merchantId, receivingId }    │ 점수 산출
    │                                │
    │                                ▼
    │                           ITANET 평가서버
    │                           (v10: 신용평가)
    │                           (v2: 마트심사)
    │                                │
    │◄──── { score: 85, grade: 'A' } │
```

---

## 5. libs/ — 공통 라이브러리

```
libs/
│
├── auth/                             ← 인증/인가 공통 모듈
│   ├── jwt.guard.ts                     JWT 토큰 검증 Guard
│   ├── roles.guard.ts                   역할 기반 접근 제어
│   ├── current-user.decorator.ts        @CurrentUser() 데코레이터
│   └── index.ts                         export
│
├── database/                         ← DB 엔티티 + 설정
│   ├── entities/                        TypeORM Entity (11개 테이블)
│   │   ├── user.entity.ts
│   │   ├── mart.entity.ts
│   │   ├── merchant.entity.ts
│   │   ├── receiving.entity.ts
│   │   ├── settlement.entity.ts
│   │   └── ...
│   └── database.module.ts               TypeORM 연결 설정
│
├── audit/                            ← 감사 로그
│   └── audit.interceptor.ts             모든 주요 행위 자동 기록
│
├── websocket/                        ← 실시간 통신
│   └── websocket.gateway.ts             WebSocket Gateway
│                                        (Socket.io 서버)
│
└── common/                           ← 공통 유틸
    ├── types/
    │   └── api-response.ts              API 응답 형식 정의
    │                                    - createResponse(data)
    │                                    - createPaginatedResponse(items, total, page, limit)
    │                                    - { success, data, meta?, error? }
    ├── errors/
    │   └── error-codes.ts               에러 코드 상수
    └── index.ts                         export
```

### 공통 라이브러리 사용 관계

```
┌───────────────────────────────────────────┐
│              libs/common                   │
│  API 응답 형식, 에러 코드                     │
├───────────────────────────────────────────┤
│              libs/database                 │
│  11개 Entity (User, Mart, Receiving...)    │
├───────────────────────────────────────────┤
│              libs/auth                     │
│  JWT Guard, Roles Guard, @CurrentUser     │
├───────────────────────────────────────────┤
│    사용처:                                  │
│    auth-api ✓  admin-api ✓  erp-api ✓     │
│    gateway-api ✓                           │
└───────────────────────────────────────────┘
```

---

## 6. scripts/ — 스크립트

```
scripts/
├── init-db.sql              ← DB 테이블 생성 SQL
│                               - CREATE TABLE users ...
│                               - CREATE TABLE marts ...
│                               - CREATE TABLE receivings ...
│                               - (11개 테이블)
│
└── seed.sql                 ← 테스트 데이터 삽입
                                - 테스트 사용자
                                - 테스트 마트
                                - 테스트 입고 데이터
```

---

## 7. infra/ — 인프라 설정

```
infra/
├── docker/
│   └── docker-compose.yaml  ← 전체 서비스 컨테이너 정의
│                               - admin-web (:3000)
│                               - auth-api (:4001)
│                               - admin-api (:4000)
│                               - erp-api (:4002)
│                               - gateway-api (:4003)
│                               - engine-api (:8000)
│                               - postgres (:5432)
│                               - redis (:6379)
│
└── nginx/
    └── nginx.conf           ← Nginx 리버스 프록시 설정
                                - HTTPS 설정
                                - WebSocket 업그레이드
                                - upstream 서버 매핑
```

---

## 8. 루트 설정 파일 요약

| 파일 | 역할 |
|------|------|
| `package.json` | 루트 패키지 — 전체 스크립트 (`pnpm dev`, `pnpm build` 등) |
| `pnpm-workspace.yaml` | 모노레포 워크스페이스 경로 정의 (`apps/*`, `services/*`, `libs/*`) |
| `turbo.json` | Turborepo 빌드 파이프라인 (병렬 빌드, 캐싱) |
| `tsconfig.base.json` | TypeScript 공통 설정 (모든 패키지가 상속) |
| `.eslintrc.js` | ESLint 린트 규칙 |
| `.prettierrc` | 코드 포맷팅 규칙 |
| `.gitlab-ci.yml` | GitLab CI/CD 파이프라인 |
| `docker-compose.yaml` | 운영 Docker Compose |
| `docker-compose.dev.yaml` | 개발 Docker Compose (hot reload 등) |
| `CLAUDE.md` | Claude Code용 프로젝트 설명 |
| `README.md` | 프로젝트 README |

---

## 9. 핵심 파일 빠른 참조 (★)

개발 시 가장 자주 보게 될 파일들입니다.

| 우선순위 | 파일 | 설명 |
|---------|------|------|
| ★★★ | `services/erp-api/src/receiving/receiving.service.ts` | 입고확인 핵심 비즈니스 로직 |
| ★★ | `apps/admin-web/src/lib/api.ts` | 모든 API 요청의 출발점 |
| ★★ | `services/gateway-api/src/proxy/proxy.middleware.ts` | URL → 서비스 라우팅 |
| ★★ | `services/erp-api/src/queue/credit-score.processor.ts` | 비동기 신용평가 Worker |
| ★★ | `engine/engine-api/services/v10_service.py` | AI 신용평가 로직 |
| ★ | `services/auth-api/src/auth/auth.service.ts` | 로그인/토큰 발급 |
| ★ | `apps/admin-web/src/hooks/use-receivings.ts` | 프론트 입고확인 API 훅 |
| ★ | `libs/common/src/types/api-response.ts` | API 응답 공통 형식 |
| ★ | `libs/database/entities/*.ts` | DB 테이블 매핑 (11개) |
